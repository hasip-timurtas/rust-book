## How to Write Tests

Test functions use the `#[test]` attribute and typically follow the arrange-act-assert pattern. Rust provides several assertion macros and the `#[should_panic]` attribute for testing error conditions.

### Test Function Basics

Generate a new library project to explore test structure:

```console
$ cargo new adder --lib
```

<Listing number="11-1" file-name="src/lib.rs" caption="Default test generated by Cargo">

```rust,editable,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-01/src/lib.rs}}
```

</Listing>

Run tests with `cargo test`:

<Listing number="11-2" caption="Test output">

```console
{{#include ../listings/ch11-writing-automated-tests/listing-11-01/output.txt}}
```

</Listing>

Test functions panic on failure. Each test runs in its own thread—when the main thread detects a test thread has died, the test is marked as failed.

Example with passing and failing tests:

<Listing number="11-3" file-name="src/lib.rs" caption="Test that fails by panicking">

```rust,editable,panics,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-03/src/lib.rs}}
```

</Listing>

### Assertion Macros

#### `assert!` Macro

Verifies a condition evaluates to `true`:

<Listing number="11-5" file-name="src/lib.rs" caption="Rectangle struct for testing">

```rust,editable,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-05/src/lib.rs}}
```

</Listing>

<Listing number="11-6" file-name="src/lib.rs" caption="Test using `assert!`">

```rust,editable,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-06/src/lib.rs:here}}
```

</Listing>

#### `assert_eq!` and `assert_ne!` Macros

Test equality and inequality with better error messages:

<Listing number="11-7" file-name="src/lib.rs" caption="Testing with `assert_eq!`">

```rust,editable,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-07/src/lib.rs}}
```

</Listing>

These macros use debug formatting, so tested values must implement `PartialEq` and `Debug` traits. Use `#[derive(PartialEq, Debug)]` for custom types.

#### Custom Failure Messages

Add custom messages with format strings:

```rust,editable,ignore
{{#rustdoc_include ../listings/ch11-writing-automated-tests/no-listing-07-custom-failure-message/src/lib.rs:here}}
```

### Testing Error Conditions

#### `#[should_panic]` Attribute

Test that code panics under certain conditions:

<Listing number="11-8" file-name="src/lib.rs" caption="Testing for panic">

```rust,editable,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-08/src/lib.rs}}
```

</Listing>

For more precise testing, specify expected panic message:

<Listing number="11-9" file-name="src/lib.rs" caption="Testing specific panic message">

```rust,editable,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-09/src/lib.rs:here}}
```

</Listing>

### Using `Result<T, E>` in Tests

Alternative to panicking—return `Result` types:

```rust,editable,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/no-listing-10-result-in-tests/src/lib.rs:here}}
```

Return `Ok(())` for success, `Err` for failure. Enables use of the `?` operator for error propagation. Cannot be combined with `#[should_panic]`—use `assert!(value.is_err())` instead.
